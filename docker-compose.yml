version: '3.8'\n\nservices:\n  # Backend API\n  backend:\n    build:\n      context: .\n      dockerfile: Dockerfile\n    container_name: financial-intel-api\n    ports:\n      - \"8000:8000\"\n    environment:\n      - ENVIRONMENT=production\n      - API_HOST=0.0.0.0\n      - API_PORT=8000\n      - SUPABASE_URL=${SUPABASE_URL:-http://supabase:8000}\n      - SUPABASE_KEY=${SUPABASE_KEY:-eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9}\n      - SUPABASE_SERVICE_KEY=${SUPABASE_SERVICE_KEY:-super-secret-jwt-token-with-at-least-32-characters-long}\n      - REDIS_URL=redis://redis:6379/0\n      - REDIS_PREFIX=statarb:\n      - REDIS_TTL=3600\n      - DEBUG=false\n      - LOG_LEVEL=INFO\n    depends_on:\n      - postgres\n      - redis\n    volumes:\n      - ./backend:/app/backend\n      - ./scripts:/app/scripts\n    networks:\n      - financial-intel\n    healthcheck:\n      test: [\"CMD\", \"curl\", \"-f\", \"http://localhost:8000/health\"]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n      start_period: 10s\n\n  # Frontend\n  frontend:\n    build:\n      context: ./frontend-v2\n      dockerfile: Dockerfile\n    container_name: financial-intel-web\n    ports:\n      - \"80:80\"\n    environment:\n      - VITE_API_BASE_URL=http://backend:8000\n      - VITE_SUPABASE_URL=${SUPABASE_URL}\n      - VITE_SUPABASE_ANON_KEY=${SUPABASE_KEY}\n    depends_on:\n      - backend\n    volumes:\n      - ./frontend-v2:/app\n    networks:\n      - financial-intel\n\n  # PostgreSQL Database (Supabase alternative)\n  postgres:\n    image: postgres:15-alpine\n    container_name: financial-intel-db\n    environment:\n      - POSTGRES_DB=financial_intel\n      - POSTGRES_USER=postgres\n      - POSTGRES_PASSWORD=postgres\n      - POSTGRES_INITDB_ARGS=--encoding=UTF8 --locale=C\n    ports:\n      - \"5432:5432\"\n    volumes:\n      - postgres_data:/var/lib/postgresql/data\n      - ./scripts/db/schema.sql:/docker-entrypoint-initdb.d/01-schema.sql\n    networks:\n      - financial-intel\n    healthcheck:\n      test: [\"CMD-SHELL\", \"pg_isready -U postgres\"]\n      interval: 10s\n      timeout: 5s\n      retries: 5\n\n  # Redis Cache\n  redis:\n    image: redis:7-alpine\n    container_name: financial-intel-cache\n    ports:\n      - \"6379:6379\"\n    volumes:\n      - redis_data:/data\n    networks:\n      - financial-intel\n    healthcheck:\n      test: [\"CMD\", \"redis-cli\", \"ping\"]\n      interval: 10s\n      timeout: 5s\n      retries: 5\n\n  # pgAdmin (Database UI - Optional)\n  pgadmin:\n    image: dpage/pgadmin4:latest\n    container_name: financial-intel-pgadmin\n    environment:\n      - PGADMIN_DEFAULT_EMAIL=admin@example.com\n      - PGADMIN_DEFAULT_PASSWORD=admin\n    ports:\n      - \"5050:80\"\n    depends_on:\n      - postgres\n    networks:\n      - financial-intel\n\nvolumes:\n  postgres_data:\n    driver: local\n  redis_data:\n    driver: local\n\nnetworks:\n  financial-intel:\n    driver: bridge\n"